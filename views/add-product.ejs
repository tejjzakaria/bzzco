<!doctype html>

<html lang="en" class="layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr" data-skin="default"
    data-bs-theme="light" data-assets-path="/assets/" data-template="vertical-menu-template">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Add Product - Bzz Co.</title>

    <meta name="description" content="" />
    <%- include("layout/header") %>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            <%- include("layout/sidebar") %>

                <div class="menu-mobile-toggler d-xl-none rounded-1">
                    <a href="javascript:void(0);"
                        class="layout-menu-toggle menu-link text-large text-bg-secondary p-2 rounded-1">
                        <i class="ri ri-menu-line icon-base"></i>
                        <i class="ri ri-arrow-right-s-line icon-base"></i>
                    </a>
                </div>
                <!-- / Menu -->

                <!-- Layout container -->
                <div class="layout-page">
                    <!-- Navbar -->
                    <%- include("layout/header") %>
                        <!-- / Navbar -->

                        <!-- Content wrapper -->
                        <div class="content-wrapper">
                            <!-- Content -->
                            <div class="container-xxl flex-grow-1 container-p-y">
                                <!-- Breadcrumb -->
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item">
                                            <a href="/view-products">Products</a>
                                        </li>
                                        <li class="breadcrumb-item active">Add Product</li>
                                    </ol>
                                </nav>
                                <form id="addProductForm" enctype="multipart/form-data" action="/api/products"
                                    method="POST">
                                    <!-- Action Buttons -->
                                    <div class="d-flex justify-content-end gap-2 mb-4">
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="window.history.back()">
                                            <i class="ri ri-arrow-left-line me-2"></i>Back
                                        </button>
                                        <div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="ri ri-save-line me-2"></i>Add Product
                                            </button>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- Left Column -->
                                        <div class="col-12 col-lg-6">
                                            <!-- Basic Product Information -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Basic Product Information</h5>
                                                </div>
                                                <div class="card-body">
                                                    <input type="hidden" id="productId" name="productId">

                                                    <!-- Product Title -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="productTitle">Product Title
                                                            *</label>
                                                        <input type="text" class="form-control" id="productTitle"
                                                            name="productTitle" placeholder="Enter product title"
                                                            required>
                                                    </div>

                                                    <!-- Category -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="category">Category *</label>
                                                        <select class="form-select" id="category" name="category"
                                                            required>
                                                            <option value="">Select Category</option>
                                                            <option value="Electronics">Electronics</option>
                                                            <option value="Clothing">Clothing</option>
                                                            <option value="Home & Garden">Home & Garden</option>
                                                            <option value="Sports">Sports</option>
                                                            <option value="Books">Books</option>
                                                            <option value="Toys">Toys</option>
                                                            <option value="Health & Beauty">Health & Beauty</option>
                                                            <option value="Automotive">Automotive</option>
                                                            <option value="Office">Office</option>
                                                            <option value="Household">Household</option>
                                                            <option value="Management">Management</option>
                                                            <option value="Food & Beverages">Food & Beverages</option>
                                                            <option value="Jewelry">Jewelry</option>
                                                            <option value="Pet Supplies">Pet Supplies</option>
                                                        </select>
                                                    </div>

                                                    <!-- Description -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="description">Description</label>
                                                        <textarea class="form-control" id="description"
                                                            name="description" rows="4"
                                                            placeholder="Enter product description"></textarea>
                                                    </div>

                                                    <!-- SKU and Barcode Row -->
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label" for="productSku">SKU *</label>
                                                            <input type="text" class="form-control" id="productSku"
                                                                name="productSku" placeholder="Enter SKU" required>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label"
                                                                for="productBarcode">Barcode</label>
                                                            <input type="text" class="form-control" id="productBarcode"
                                                                name="productBarcode" placeholder="Enter barcode">
                                                        </div>
                                                    </div>

                                                    <!-- Manufacturer and Dimensions Row -->
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label"
                                                                for="manufacturer">Manufacturer</label>
                                                            <input type="text" class="form-control" id="manufacturer"
                                                                name="manufacturer" placeholder="Enter manufacturer">
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label"
                                                                for="dimensions">Dimensions</label>
                                                            <input type="text" class="form-control" id="dimensions"
                                                                name="dimensions" placeholder="L x W x H">
                                                        </div>
                                                    </div>

                                                    <!-- Weight -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="weight">Weight</label>
                                                        <div class="input-group">
                                                            <input type="text" class="form-control" id="weight"
                                                                name="weight" placeholder="Enter weight">
                                                            <span class="input-group-text">kg</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Pricing -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Pricing</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label" for="productPrice">Price *</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text">$</span>
                                                                <input type="number" class="form-control"
                                                                    id="productPrice" name="productPrice"
                                                                    placeholder="0.00" step="0.01" min="0" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label"
                                                                for="productDiscountedPrice">Discounted Price</label>
                                                            <div class="input-group">
                                                                <span class="input-group-text">$</span>
                                                                <input type="number" class="form-control"
                                                                    id="productDiscountedPrice"
                                                                    name="productDiscountedPrice" placeholder="0.00"
                                                                    step="0.01" min="0">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Tax Settings -->
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" name="chargeTax"
                                                            id="chargeTax" checked>
                                                        <label class="form-check-label" for="chargeTax">
                                                            Charge tax on this product
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Product Images -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Product Images</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label class="form-label" for="images">Upload Images</label>
                                                        <input type="file" class="form-control" id="images"
                                                            name="images" multiple accept="image/*">
                                                        <small class="text-muted">You can select multiple images</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Product Identification -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Product Identification</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label" for="productIdType">Product ID
                                                                Type</label>
                                                            <select class="form-select" id="productIdType"
                                                                name="productIdType">
                                                                <option value="">Select ID Type</option>
                                                                <option value="ISBN">ISBN</option>
                                                                <option value="UPC">UPC</option>
                                                                <option value="EAN">EAN</option>
                                                                <option value="JAN">JAN</option>
                                                                <option value="GTIN">GTIN</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label" for="productIdNumber">Product ID
                                                                Number</label>
                                                            <input type="text" class="form-control" id="productIdNumber"
                                                                name="productIdNumber" placeholder="Enter ID number">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Right Column -->
                                        <div class="col-12 col-lg-6">
                                            <!-- Inventory & Organization -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Inventory & Organization</h5>
                                                </div>
                                                <div class="card-body">
                                                    <!-- Quantity -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="quantity">Quantity *</label>
                                                        <input type="number" class="form-control" id="quantity"
                                                            name="quantity" placeholder="Enter quantity" min="0"
                                                            required>
                                                    </div>

                                                    <!-- Vendor -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="vendor">Vendor</label>
                                                        <select class="form-select" id="vendor" name="vendor">
                                                            <option value="">Select Vendor</option>
                                                            <option value="men-clothing">Men's Clothing</option>
                                                            <option value="women-clothing">Women's Clothing</option>
                                                            <option value="kid-clothing">Kid's Clothing</option>
                                                            <option value="electronics-vendor">Electronics Vendor
                                                            </option>
                                                            <option value="home-garden-vendor">Home & Garden Vendor
                                                            </option>
                                                        </select>
                                                    </div>

                                                    <!-- Status and Stock Row -->
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label" for="status">Status</label>
                                                            <select class="form-select" id="status" name="status">
                                                                <option value="Published">Published</option>
                                                                <option value="Scheduled">Scheduled</option>
                                                                <option value="Inactive">Inactive</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label class="form-label">Stock Status</label>
                                                            <div class="form-check form-switch mt-2">
                                                                <input class="form-check-input" type="checkbox"
                                                                    id="inStock" name="inStock" checked>
                                                                <label class="form-check-label" for="inStock">In
                                                                    Stock</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Tags -->
                                                    <div class="mb-3">
                                                        <label class="form-label" for="tags">Tags</label>
                                                        <input type="text" class="form-control" id="tags" name="tags"
                                                            placeholder="Enter tags separated by commas">
                                                        <small class="text-muted">Separate multiple tags with
                                                            commas</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Product Variants -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Product Variants</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div id="variantsContainer">
                                                        <div class="variant-item border p-3 mb-3 rounded">
                                                            <div class="row">
                                                                <div class="col-5">
                                                                    <label class="form-label">Type</label>
                                                                    <select class="form-select variant-type"
                                                                        name="variants[0][type]">
                                                                        <option value="">Select Type</option>
                                                                        <option value="size">Size</option>
                                                                        <option value="color">Color</option>
                                                                        <option value="weight">Weight</option>
                                                                        <option value="smell">Smell</option>
                                                                        <option value="material">Material</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-5">
                                                                    <label class="form-label">Value</label>
                                                                    <input type="text"
                                                                        class="form-control variant-value"
                                                                        name="variants[0][value]"
                                                                        placeholder="Enter value">
                                                                </div>
                                                                <div class="col-2 d-flex align-items-end">
                                                                    <button type="button"
                                                                        class="btn btn-danger btn-sm remove-variant">
                                                                        <i class="ri ri-delete-bin-line"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-outline-primary btn-sm"
                                                        id="addVariant">
                                                        <i class="ri ri-add-line me-2"></i>Add Variant
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Shipping & Delivery -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Shipping & Delivery</h5>
                                                </div>
                                                <div class="card-body">
                                                    <!-- Shipping Type -->
                                                    <div class="mb-3">
                                                        <label class="form-label">Shipping Type</label>
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="radio"
                                                                name="shippingType" id="seller" value="seller">
                                                            <label class="form-check-label" for="seller">
                                                                <strong>Fulfilled by Seller</strong><br>
                                                                <small class="text-muted">You handle delivery</small>
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="shippingType" id="company" value="company"
                                                                checked>
                                                            <label class="form-check-label" for="company">
                                                                <strong>Fulfilled by Company</strong> <span
                                                                    class="badge bg-warning text-dark">RECOMMENDED</span><br>
                                                                <small class="text-muted">We handle delivery</small>
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <!-- Global Delivery -->
                                                    <div class="mb-3">
                                                        <label class="form-label">Global Delivery</label>
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="radio"
                                                                name="globalDelivery" id="worldwide" value="worldwide">
                                                            <label class="form-check-label" for="worldwide">
                                                                <strong>Worldwide</strong>
                                                            </label>
                                                        </div>
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="radio"
                                                                name="globalDelivery" id="selectedCountries"
                                                                value="selected-countries" checked>
                                                            <label class="form-check-label" for="selectedCountries">
                                                                <strong>Selected Countries</strong>
                                                            </label>
                                                        </div>
                                                        <div class="mb-2">
                                                            <input type="text" class="form-control form-control-sm"
                                                                name="selectedCountries"
                                                                placeholder="Enter countries separated by commas">
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="globalDelivery" id="local" value="local">
                                                            <label class="form-check-label" for="local">
                                                                <strong>Local delivery only</strong>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Product Attributes -->
                                            <div class="card mb-4">
                                                <div class="card-header">
                                                    <h5 class="card-title mb-0">Product Attributes</h5>
                                                </div>
                                                <div class="card-body">
                                                    <!-- Fragile -->
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox"
                                                            name="attributes[fragile]" id="fragile">
                                                        <label class="form-check-label" for="fragile">
                                                            Fragile Product
                                                        </label>
                                                    </div>

                                                    <!-- Biodegradable -->
                                                    <div class="form-check mb-3">
                                                        <input class="form-check-input" type="checkbox"
                                                            name="attributes[biodegradable]" id="biodegradable">
                                                        <label class="form-check-label" for="biodegradable">
                                                            Biodegradable
                                                        </label>
                                                    </div>

                                                    <!-- Frozen Product -->
                                                    <div class="mb-3">
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="checkbox"
                                                                name="attributes[frozen]" id="frozen">
                                                            <label class="form-check-label" for="frozen">
                                                                Frozen Product
                                                            </label>
                                                        </div>
                                                        <div class="frozen-temp-field" style="display: none;">
                                                            <input type="number" class="form-control form-control-sm"
                                                                name="attributes[maxTemperature]" id="maxTemperature"
                                                                placeholder="Max temp (°C)">
                                                        </div>
                                                    </div>

                                                    <!-- Expiry Date -->
                                                    <div class="mb-3">
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="checkbox"
                                                                name="attributes[hasExpiryDate]" id="hasExpiryDate">
                                                            <label class="form-check-label" for="hasExpiryDate">
                                                                Has Expiry Date
                                                            </label>
                                                        </div>
                                                        <div class="expiry-date-field" style="display: none;">
                                                            <input type="date" class="form-control form-control-sm"
                                                                name="attributes[expiryDate]" id="expiryDate">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!-- / Content -->

                            <!-- Footer -->
                            <%- include("layout/footer") %>
                                <!-- / Footer -->

                                <div class="content-backdrop fade"></div>
                        </div>
                        <!-- Content wrapper -->
                </div>
                <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>

        <!-- Drag Target Area To SlideIn Menu On Small Screens -->
        <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <script src="/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="/assets/vendor/libs/popper/popper.js"></script>
    <script src="/assets/vendor/js/bootstrap.js"></script>
    <script src="/assets/vendor/libs/node-waves/node-waves.js"></script>
    <script src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/assets/vendor/libs/hammer/hammer.js"></script>
    <script src="/assets/vendor/libs/i18n/i18n.js"></script>
    <script src="/assets/vendor/libs/typeahead-js/typeahead.js"></script>
    <script src="/assets/vendor/js/menu.js"></script>

    <!-- Vendors JS -->
    <script src="/assets/vendor/libs/select2/select2.js"></script>
    <script src="/assets/vendor/libs/sweetalert2/sweetalert2.js"></script>

    <!-- Main JS -->
    <script src="/assets/js/main.js"></script>

    <!-- Page specific JS -->
    <script>
        // Image preview functionality
        document.addEventListener('DOMContentLoaded', function () {
            const imageInput = document.getElementById('images');

            // Create a preview container after the file input
            const previewContainer = document.createElement('div');
            previewContainer.id = 'imagePreview';
            previewContainer.className = 'd-flex flex-wrap gap-2 mt-3';
            imageInput.parentNode.appendChild(previewContainer);

            imageInput.addEventListener('change', function (e) {
                const files = e.target.files;
                previewContainer.innerHTML = ''; // Clear previous previews

                if (files.length > 0) {
                    Array.from(files).forEach((file, index) => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();

                            reader.onload = function (e) {
                                const imageDiv = document.createElement('div');
                                imageDiv.className = 'position-relative d-inline-block';
                                imageDiv.innerHTML = `
                                    <img src="${e.target.result}" 
                                         alt="Preview ${index + 1}" 
                                         class="img-thumbnail" 
                                         style="width: 100px; height: 100px; object-fit: cover;">
                                    <button type="button" 
                                            class="btn btn-sm btn-danger position-absolute top-0 end-0" 
                                            style="transform: translate(50%, -50%); border-radius: 50%; width: 25px; height: 25px; padding: 0;"
                                            onclick="removePreviewImage(this, ${index})">
                                        <i class="ri-close-line" style="font-size: 12px;"></i>
                                    </button>
                                `;
                                previewContainer.appendChild(imageDiv);
                            };

                            reader.readAsDataURL(file);
                        }
                    });
                }
            });
        });

        // Remove preview image
        function removePreviewImage(button, index) {
            const imageDiv = button.parentElement;
            imageDiv.remove();

            // Update the file input to remove the selected file
            const imageInput = document.getElementById('images');
            const dt = new DataTransfer();
            const files = imageInput.files;

            for (let i = 0; i < files.length; i++) {
                if (i !== index) {
                    dt.items.add(files[i]);
                }
            }

            imageInput.files = dt.files;
        }

        // Variant management
        let variantIndex = 1;

        document.getElementById('addVariant').addEventListener('click', function () {
            const container = document.getElementById('variantsContainer');
            const newVariant = document.createElement('div');
            newVariant.className = 'variant-item border p-3 mb-3 rounded';
            newVariant.innerHTML = `
                <div class="row">
                    <div class="col-5">
                        <label class="form-label">Type</label>
                        <select class="form-select variant-type" name="variants[${variantIndex}][type]">
                            <option value="">Select Type</option>
                            <option value="size">Size</option>
                            <option value="color">Color</option>
                            <option value="weight">Weight</option>
                            <option value="smell">Smell</option>
                            <option value="material">Material</option>
                        </select>
                    </div>
                    <div class="col-5">
                        <label class="form-label">Value</label>
                        <input type="text" class="form-control variant-value" name="variants[${variantIndex}][value]" 
                               placeholder="Enter value">
                    </div>
                    <div class="col-2 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-sm remove-variant">
                            <i class="ri ri-delete-bin-line"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newVariant);
            variantIndex++;
        });

        // Remove variant functionality
        document.addEventListener('click', function (e) {
            if (e.target.closest('.remove-variant')) {
                e.target.closest('.variant-item').remove();
            }
        });

        // Show/hide frozen temperature field
        document.getElementById('frozen').addEventListener('change', function () {
            const tempField = document.querySelector('.frozen-temp-field');
            if (this.checked) {
                tempField.style.display = 'block';
            } else {
                tempField.style.display = 'none';
                document.getElementById('maxTemperature').value = '';
            }
        });

        // Show/hide expiry date field
        document.getElementById('hasExpiryDate').addEventListener('change', function () {
            const expiryField = document.querySelector('.expiry-date-field');
            if (this.checked) {
                expiryField.style.display = 'block';
            } else {
                expiryField.style.display = 'none';
                document.getElementById('expiryDate').value = '';
            }
        });

        // Form submission
        document.getElementById('addProductForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Show loading
            Swal.fire({
                title: 'Adding Product...',
                text: 'Please wait while we add the product.',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Create FormData object with all form data
            const formData = new FormData(this);

            // Convert variants to proper format and add to FormData
            const variants = [];
            const variantTypes = document.querySelectorAll('.variant-type');
            const variantValues = document.querySelectorAll('.variant-value');

            for (let i = 0; i < variantTypes.length; i++) {
                if (variantTypes[i].value && variantValues[i].value) {
                    variants.push({
                        type: variantTypes[i].value,
                        value: variantValues[i].value
                    });
                }
            }
            formData.append('variants', JSON.stringify(variants));

            // Convert attributes to proper format and add to FormData
            const attributes = {
                fragile: document.getElementById('fragile').checked,
                biodegradable: document.getElementById('biodegradable').checked,
                frozen: document.getElementById('frozen').checked,
                maxTemperature: document.getElementById('maxTemperature').value || undefined,
                hasExpiryDate: document.getElementById('hasExpiryDate').checked,
                expiryDate: document.getElementById('expiryDate').value || undefined
            };
            formData.append('attributes', JSON.stringify(attributes));

            // Convert tags to array and add to FormData
            const tagsInput = document.getElementById('tags').value;
            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
            formData.append('tags', JSON.stringify(tags));

            // Convert selectedCountries to array and add to FormData
            const countriesInput = document.querySelector('input[name="selectedCountries"]').value;
            const selectedCountries = countriesInput ? countriesInput.split(',').map(country => country.trim()) : [];
            formData.append('selectedCountries', JSON.stringify(selectedCountries));

            // Submit form
            fetch('/api/products', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    Swal.close();
                    if (data.success) {
                        Swal.fire({
                            title: 'Success!',
                            text: 'Product added successfully.',
                            icon: 'success',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/view-products';
                        });
                    } else {
                        Swal.fire('Error', data.message || 'Failed to add product', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.close();
                    Swal.fire('Error', 'Failed to add product. Please try again.', 'error');
                });
        });
    </script>
</body>

</html>